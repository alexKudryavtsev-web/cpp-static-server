### –î–µ–Ω—å 1: –ø–æ–¥–∫–ª—é—á–∞–µ–º boost –∏ Docker

–í –∫–∞—á–µ—Å—Ç–≤–µ –∫—É—Ä—Å–∞—á–∞ —è –±—É–¥—É –ø–∏—Å–∞—Ç—å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø–æ —Ä–∞–±–æ—Ç–µ —Å–æ —Å—Ç–∞—Ç–∏–∫–æ–π: —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ –∏ —Ç.–ø. –£ –Ω–µ–≥–æ –±—É–¥–µ—Ç –∫—Ä–∞–π–Ω–µ –ø—Ä–æ—Å—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª: –ø–æ–ª—É—á–∞—Ç—å —Å—Ç–∞—Ç–∏–∫—É –∏ —Ä–∞–∑–¥–∞–≤–∞—Ç—å –µ–µ. –¢–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã —Ç—Ä–µ–±—É—é—Ç –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ø–æ—ç—Ç–æ–º—É –∏—Ö –ø–∏—à—É—Ç –Ω–∞ C++.

–í–∞–Ω–∏–ª—å–Ω–æ–≥–æ C++ –Ω–∞–º –Ω–µ —Ö–≤–∞—Ç–∏—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –Ω–µ–º –Ω–µ—Ç –º–Ω–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞. –¢–∞–∫ —á—Ç–æ, —É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥–µ—Ç –æ–¥–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ boost, –∫–æ—Ç–æ—Ä–∞—è –ª—é–±–µ–∑–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Ä—è–¥ –Ω–µ–±–æ–ª—å—à–∏—Ö –ø–æ–ª–µ–∑–Ω—ã—Ö —Ñ–∏—á.

–°–µ–≥–æ–¥–Ω—è —è –∑–∞–π–º—É—Å—å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Å—Ä–µ–¥—ã –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–µ–π. –°—Ä–∞–∑—É —Å–∫–∞–∂—É, —á—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±—É–¥–µ—Ç –≤–µ—Å—Ç–∏—Å—å –Ω–∞ MacOS (–Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–æ–≤–µ—Ç–æ–≤ –±—É–¥–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ –∏ –¥–ª—è Linux-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) –∏ –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Visual Studio.

1) –£—Å—Ç–∞–Ω–æ–≤–∏–º boost –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
brew install boost
```

–Ø –¥–µ–ª–∞—é —ç—Ç–æ, —á—Ç–æ–±—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä –º–æ–≥ –º–Ω–µ –¥–µ–ª–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —Ç–æ–ª—å–∫–æ. –í –º–æ–µ–º —Å–ª—É—á–∞–µ, –Ω–∞–¥–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–π—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VS Code –∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –æ–±–æ–ª—á–∫–∏ —É–∫–∞–∑–∞—Ç—å –≤ includePath –∑–Ω–∞—á–µ–Ω–∏–µ /opt/homebrew/include/**.

–ë—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –≤—Å–µ —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–º –æ–±–µ—Å–ø–µ—á–µ–Ω—ã üòá.

2) Docker:

–¢–µ–ø–µ—Ä—å —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ. –ù–∞–º –Ω–∞–¥–æ –æ–±–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –¥–æ–∫–µ—Ä. –Ø –ø—Ä–µ–¥–ª–∞–≥–∞—é —Ç–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥:

```docker
FROM ubuntu:latest

WORKDIR /app

RUN apt-get upgrade
RUN apt-get update && apt-get install -y \
    g++ \
    libcpprest-dev \
    libboost-all-dev \
    libssl-dev \
    cmake

COPY main.cpp .

RUN g++ -o main main.cpp -lcpprest -lboost_system -lboost_thread -lboost_chrono -lboost_random -lssl -lcrypto

EXPOSE 8080

CMD ["./main"]
```

–í –¥–∞–ª—å–Ω–µ–π—à–µ–º –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—É–¥–µ—Ç:

```bash
docker build -t cppstaticserver .
docker run cppstaticserver
```

–ò –≤—Å–µ —á—É–¥–µ—Å–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è!

–¢–∞–∫ –≤–æ—Ç, –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –¥–∞–≤–∞–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏–º —Ç–∞–∫—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏ –º–æ—â–∏ boost –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç uuid:

```cpp
#include <boost/uuid/uuid.hpp>
#include <boost/uuid/uuid_generators.hpp>
#include <boost/uuid/uuid_io.hpp>
#include <iostream>

int main() {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ UUID
  boost::uuids::random_generator generator;

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID
  boost::uuids::uuid uuid = generator();

  // –í—ã–≤–æ–¥ UUID –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—ã–≤–æ–¥–∞
  std::cout << "UUID: " << uuid << std::endl;

  return 0;
}
```

–í–≤–µ–¥–µ–º –¥–≤–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã—à–µ –∏ –ø–æ–ª—É—á–∏–º —á—Ç–æ-—Ç–æ —Ç–∏–ø–∞ —Ç–∞–∫–æ–≥–æ:

```bash
alexander@MacBook-Pro-Alexander CppStaticServer % docker run mycppapp
UUID: 2e50e3e1-8f8c-48e1-82ad-3ab0e14f8c8b
```

–£—Ä–∞! –£ –Ω–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞!


### –î–µ–Ω—å 2: –Ω–∞–∫–∞—Ç–∏–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –∑–∞–ø—É—Å—Ç–∏–º HTTP-—Å–µ—Ä–≤–µ—Ä

1) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å HTTP-—Å–µ—Ä–≤–µ—Ä —Å—Ç–æ–∏—Ç –Ω–∞–±—Ä–æ—Å–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–≥—Ä–∞–Ω–∏—á–∏–º—Å—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π. –ù–∞–ø–æ–º–Ω—é, —á—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - —ç—Ç–æ –∂–µ –µ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ. –î–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –æ–±–æ—Å–Ω–æ–≤–∞–Ω —Ç–µ–º, —á—Ç–æ –ø—Ä–æ—Ñ–∏—Ç–∞ –æ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –Ω–µ –±—É–¥–µ—Ç –≤ —Ç–∞–∫–æ–º –º–∞–ª–µ–Ω—å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ù–∞–æ–±–æ—Ä–æ—Ç, —ç—Ç–æ —É—Å–ª–æ–∂–Ω–∏—Ç –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º.

–û—Å—Ç–∞–Ω–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–ª–æ–∂–∏—Ç—å –∫–æ–¥ –ø–æ –ø–∞–ø–∫–∞–º. –Ø –ø—Ä–µ–¥–ª–∞–≥–∞—é –≤–∞—Ä–∏–∞–Ω—Ç:

```tree
/src - –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã
/include - –∑–∞–≥–æ–ª–æ–≤–∫–∏
main.cpp - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

–¢–µ–ø–µ—Ä—å –Ω–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –ø–æ–ø—Ä–∞–≤–∏—Ç—å Dockerfile:

```docker
COPY main.cpp .
COPY src/ .
COPY include/ .
```

–ö–∞–∫ –≤–∏–¥–Ω–æ, —è –¥–æ–±–∞–≤–∏–ª –µ—â–µ –¥–≤–∞ –≤—ã–∑–æ–≤–∞ COPY. –í—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ src –∏ include –ø–æ–ø–∞–¥–µ—Ç –≤ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞. –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ –≤ –∫–æ—Ä–Ω–µ–≤—É—é? –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –º—ã —Å–º–æ–∂–µ–º –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ç–∞–∫–æ–π –ø—Ä–∏—è—Ç–Ω—ã–π –∏–º–ø–æ—Ä—Ç:

```cpp
#include "server.h"
```

–ó–∞ –º–µ—Å—Ç–æ:

```cpp
#include "include/server.h"
```

–¢—É—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è. –û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, —Ç–æ –Ω–∞–¥–æ –±—É–¥–µ—Ç –ø—Ä–æ–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ includePath –≤–∞—à–µ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞.

2) HTTP-—Å–µ—Ä–≤–µ—Ä.

–í–≤–µ–¥–µ–º —Å—É—â–Ω–æ—Å—Ç–∏: Server - —ç—Ç–æ –ø—Ä–æ—Å–ª–æ–π–∫–∞ –Ω–∞–¥ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ boost, Server –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≤—ã–¥–∞–µ–º –∏–º Session - —Å–µ—Å—Å–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã.

```cpp
class Server
{
public:
  Server(short port) : acceptor_(io_service_, tcp::endpoint(tcp::v4(), port))
  {
    do_accept();
  }

  void run()
  {
    io_service_.run();
  }

private:
  void do_accept()
  {
    acceptor_.async_accept(
        [this](boost::system::error_code ec, tcp::socket socket)
        {
          if (!ec)
          {
            std::make_shared<Session>(std::move(socket))->start();
          }
          do_accept();
        });
  }

  boost::asio::io_service io_service_;
  tcp::acceptor acceptor_;
};
```

–ö–∞–∫ –≤–∏–¥–Ω–æ, Server –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç boost-—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä –∏ –≤–æ –≤—Ä–µ–º—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–∞–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é. Session —è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—é –≤ —É–∫–æ—Ä–µ—á–µ–Ω–Ω–æ–º –≤–∏–¥–µ:

```cpp
class Session : public std::enable_shared_from_this<Session>
{
public:
  Session(tcp::socket socket) : socket_(std::move(socket)) {}

  void start()
  {
    do_read();
  }

private:
  tcp::socket socket_;
  std::string request_;

 void do_read()
  {
    auto self(shared_from_this());
    request_.resize(1024);
    socket_.async_read_some(boost::asio::buffer(request_),
                            [this, self](boost::system::error_code ec, std::size_t length)
                            {
                              if (!ec)
                              {
                                handle_request(request_);
                              }
                            });
  }

  void do_write(const std::string &response)
  {
    auto self(shared_from_this());
    boost::asio::async_write(socket_, boost::asio::buffer(response),
                             [this, self](boost::system::error_code ec, std::size_t /*length*/)
                             {
                               if (!ec)
                               {
                                 socket_.close();
                               }
                             });
  }
};
```

–ó–¥–µ—Å—å –æ–ø—É—â–µ–Ω–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ handle_request. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –±—ã–ª —Å–æ–∑–¥–∞–Ω –ø—Ä–æ—Å—Ç–µ–Ω—å–∫–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫. –î–µ—Ç–∞–ª—å–Ω–µ–µ –ø—Ä–æ —Ä–æ—É—Ç–∏–Ω–≥ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –±—É–¥–µ—Ç –∑–∞–≤—Ç—Ä–∞.

–°–µ–π—á–∞—Å –∂–µ —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é. –ú–µ—Ç–æ–¥–æ–º do_read –±—É–¥–µ–º —Å—á–∏—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –º–µ—Ç–æ–¥–æ–º do_write - –æ—Ç–≤–µ—á–∞—Ç—å –µ–º—É. –í –æ–±–æ–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö –≤—Å–µ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

–¢–µ–ø–µ—Ä—å –≤ main.cpp –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Å–µ–≥–æ –ª–∏—à—å —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä Server –∏ –≤—ã–∑–≤–∞—Ç—å —É –Ω–µ–≥–æ run:

```cpp
#include "server.h"
#include <iostream>

int main()
{
  try
  {
    std::cout << "Start app on 8080" << std::endl;
    Server s(8080);
    s.run();
  }
  catch (std::exception &e)
  {
    std::cerr << "Exception: " << e.what() << std::endl;
  }
  return 0;
}
```

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å–µ–π—á–∞—Å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –±—É–¥—É—Ç –º–∞–ø–ø–∏—Ç—å—Å—è –ø–æ—Ä—Ç:

```shell
docker run -p 8080:8080 cppapp
```

–£—Ä–∞! –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –ø–æ—á—Ç–∏ –≤–µ—Å—å boilerplate-–∫–æ–¥ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞, –∞ –∏–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π HTTP-—Å–µ—Ä–≤–µ—Ä!